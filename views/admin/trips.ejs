<!DOCTYPE html>
<html>
<head>
    <title>Trips - Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
     <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/admin.css">
</head>

<body>

<%- include('../partials/adminNavbar') %>

<div class="container mt-5">

    <h3 class="mb-4">Trips Management</h3>

    <% if (trips.length === 0) { %>
        <div class="alert alert-info">
            No trips available.
        </div>
    <% } else { %>

    <table class="table table-bordered table-hover align-middle">

        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Destination</th>
                <th>Date</th>
                <th>Vehicle</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
        <% trips.forEach(t => { %>
            <tr id="trip-row-<%= t.id %>">

                <td><%= t.id %></td>
                <td><%= t.destination %></td>
                <td><%= t.date %></td>
                <td><%= t.vehicle_number %></td>

                <td id="status-<%= t.id %>">
                    <span class="badge 
                        <%= t.status === 'completed' ? 'bg-primary' : 'bg-success' %>">
                        <%= t.status %>
                    </span>
                </td>

                <td>
                    <% if (t.status !== 'completed') { %>
                        <button class="btn btn-sm btn-primary"
                                onclick="completeTrip('<%= t.id %>')">
                            Mark Completed
                        </button>
                    <% } else { %>
                        â€”
                    <% } %>
                </td>

            </tr>
        <% }) %>
        </tbody>

    </table>

    <% } %>

</div>

<script>
function completeTrip(id) {

    fetch(`/trips/complete/${id}`, {
        method: 'PUT'
    })
    .then(res => res.json())
    .then(data => {

        document.getElementById(`status-${id}`).innerHTML =
            '<span class="badge bg-primary">completed</span>';

        const row = document.getElementById(`trip-row-${id}`);
        const button = row.querySelector('button');
        if (button) button.remove();

    })
    .catch(err => console.error(err));
}
</script>

</body>
</html>